<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TABAQO â€“ Compra por WhatsApp</title>

<style>
:root{
  --bg:#000;
  --fg:#f5f5f5;
  --gold:#f6c000;
  --border:#222;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--fg);
  background:#000;
  background-image:url("https://i.imgur.com/iacVJrq.png");
  background-repeat:no-repeat;
  background-position:center top;
  background-size:420px;
  background-attachment:fixed;
}

/* Oscurecer fondo para contraste */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.78);
  z-index:-1;
}

header{
  position:sticky;
  top:0;
  background:#000;
  border-bottom:1px solid var(--border);
  z-index:10;
}

.header-inner{
  max-width:1100px;
  margin:auto;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:900;
  letter-spacing:2px;
  color:var(--gold);
}

.cart-btn{
  cursor:pointer;
  font-size:20px;
}

main{
  max-width:1100px;
  margin:auto;
  padding:40px 20px;
}

h2{
  text-align:center;
  letter-spacing:2px;
  margin-bottom:40px;
}

.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:40px;
}

.product{
  background:#fff;
  color:#000;
  padding:20px;
  text-align:center;
}

.product img{
  max-width:180px;
  margin-bottom:16px;
}

.qty{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}

.qty button{
  width:32px;
  height:32px;
  font-weight:900;
}

.add{
  width:100%;
  padding:8px;
  font-weight:900;
  cursor:pointer;
}

.cart-page{
  display:none;
}

.cart-page.active{
  display:block;
}

.products-page.active{
  display:block;
}

.products-page{
  display:none;
}

.cart-list{
  list-style:none;
  padding:0;
}

.cart-list li{
  display:flex;
  justify-content:space-between;
  margin-bottom:8px;
}

.buy{
  width:100%;
  padding:14px;
  background:var(--gold);
  font-weight:900;
  border:none;
  cursor:pointer;
  margin-top:20px;
}

footer{
  margin-top:60px;
  text-align:center;
  font-size:12px;
  opacity:.7;
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div>TABAQO</div>
    <div class="cart-btn" onclick="showCart()">ðŸ›’</div>
  </div>
</header>

<main>

<section class="products-page active" id="productsPage">
  <h2>PRODUCTOS</h2>
  <div class="products" id="products"></div>
</section>

<section class="cart-page" id="cartPage">
  <h2>CARRITO</h2>
  <ul class="cart-list" id="cartList"></ul>
  <div><b>Total:</b> <span id="cartTotal">$0</span></div>
  <button class="buy" onclick="buy()">INICIAR COMPRA POR WHATSAPP</button>
  <button class="buy" style="background:#111;color:#fff" onclick="clearCart()">VACIAR CARRITO</button>
</section>

<footer>
Compra directa por WhatsApp Â· No se solicitan datos personales
</footer>

</main>

<script>
const SHEET =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRXfu7as7scLMqrv48bHpytzzRwK0VlgPfVrOJ_3MsqnNBzfC0TRjsfO52HSsVjMkAzWJaGvcMh12Hv/pub?output=csv";

const PHONE="5493515060159";
let products=[], cart={}, pending={};

const productsEl=document.getElementById("products");
const cartList=document.getElementById("cartList");
const cartTotal=document.getElementById("cartTotal");

function money(n){return "$"+n.toLocaleString("es-AR")}

function parseCSV(t){
  const [h,...r]=t.trim().split("\n").map(l=>l.split(","));
  return r.map(l=>Object.fromEntries(h.map((k,i)=>[k.trim(),l[i]?.trim()])));
}

async function load(){
  const res=await fetch(SHEET+"&v="+Date.now());
  const rows=parseCSV(await res.text());
  products=rows.filter(p=>p.activo==="1");
  render();
}

function render(){
  productsEl.innerHTML="";
  products.forEach(p=>{
    const q=pending[p.id]||0;
    const d=document.createElement("div");
    d.className="product";
    d.innerHTML=`
      <img src="${p.imagen}">
      <div>${p.nombre}</div>
      <div>${money(+p.precio)}</div>
      <div class="qty">
        <button onclick="pending['${p.id}']=(pending['${p.id}']||0)-1;render()">âˆ’</button>
        <b>${q}</b>
        <button onclick="pending['${p.id}']=(pending['${p.id}']||0)+1;render()">+</button>
      </div>
      <button class="add" onclick="add('${p.id}')">AGREGAR</button>
    `;
    productsEl.appendChild(d);
  });
  updateCart();
}

function add(id){
  if(!pending[id])return;
  cart[id]=(cart[id]||0)+pending[id];
  pending[id]=0;
  render();
}

function updateCart(){
  cartList.innerHTML="";
  let total=0;
  for(const id in cart){
    const p=products.find(x=>x.id===id);
    const sub=cart[id]*p.precio;
    total+=sub;
    cartList.innerHTML+=`<li><span>${p.nombre} x${cart[id]}</span><span>${money(sub)}</span></li>`;
  }
  cartTotal.textContent=money(total);
}

function buy(){
  let txt="Hola ðŸ‘‹ Quiero comprar:\n\n";
  let total=0;
  for(const id in cart){
    const p=products.find(x=>x.id===id);
    const sub=cart[id]*p.precio;
    total+=sub;
    txt+=`â€¢ ${p.nombre} x${cart[id]} â€“ ${money(sub)}\n`;
  }
  txt+=`\nTotal: ${money(total)}`;
  location.href=`https://wa.me/${PHONE}?text=${encodeURIComponent(txt)}`;
}

function clearCart(){cart={};updateCart();}

function showCart(){
  productsPage.classList.remove("active");
  cartPage.classList.add("active");
}

load();
</script>

</body>
</html>

