<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TABACO â€“ Compra por WhatsApp</title>

<style>
:root{
  --bg:#000;
  --fg:#f5f5f5;
  --gold:#f6c000;
  --border:#222;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,Segoe UI,Arial;
  background:var(--bg);
  color:var(--fg);
}
header{
  position:sticky;
  top:0;
  background:#000;
  border-bottom:1px solid var(--border);
  z-index:10;
}
.header-inner{
  max-width:1100px;
  margin:auto;
  padding:14px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:800;
  letter-spacing:2px;
  color:var(--gold);
}
.cart-btn{
  background:#111;
  border:1px solid #333;
  border-radius:20px;
  color:var(--gold);
  padding:8px 14px;
  cursor:pointer;
  font-weight:900;
}
.cart-btn span{
  background:var(--gold);
  color:#000;
  border-radius:10px;
  padding:2px 7px;
  margin-left:6px;
  font-size:12px;
}
.tabs{
  display:flex;
  justify-content:center;
  gap:20px;
  padding:20px 0;
}
.tabs button{
  background:#111;
  border:1px solid #333;
  color:#fff;
  padding:10px 18px;
  cursor:pointer;
  font-weight:800;
}
.tabs button.active{
  background:var(--gold);
  color:#000;
}
main{max-width:1100px;margin:auto;padding:0 20px 40px}
.section{display:none}
.section.active{display:block}

.products{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:40px;
}
.product{
  background:#fff;
  color:#000;
  padding:20px;
  text-align:center;
}
.product img{
  max-width:160px;
  margin-bottom:12px;
}
.qty{
  display:flex;
  justify-content:center;
  gap:10px;
  margin:10px 0;
}
.qty button{width:32px;height:32px}
.add{font-weight:900;padding:6px 14px;cursor:pointer}

.cart ul{list-style:none;padding:0}
.cart li{
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}
.buy{
  width:100%;
  background:var(--gold);
  border:none;
  padding:14px;
  font-weight:900;
  cursor:pointer;
}
.danger{
  width:100%;
  margin-top:10px;
  background:#111;
  color:#fff;
  border:1px solid #333;
  padding:12px;
  cursor:pointer;
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div>TABACO</div>
    <button class="cart-btn" id="cartTabBtn">ðŸ›’ <span id="cartCount">0</span></button>
  </div>
</header>

<div class="tabs">
  <button class="active" data-tab="productos">PRODUCTOS</button>
  <button data-tab="combinados">COMBINADOS</button>
  <button data-tab="carrito">CARRITO</button>
</div>

<main>
  <section id="productos" class="section active">
    <div class="products" id="products"></div>
  </section>

  <section id="combinados" class="section">
    <div class="products" id="combinadosList"></div>
  </section>

  <section id="carrito" class="section cart">
    <ul id="cartList"></ul>
    <div><b>Total:</b> <span id="cartTotal">$0</span></div>
    <button class="buy" id="buyBtn">INICIAR COMPRA POR WHATSAPP</button>
    <button class="danger" id="clearBtn">BORRAR CARRITO</button>
  </section>
</main>

<script>
const WHATSAPP_PHONE="5493515060159";
const SHEET="https://docs.google.com/spreadsheets/d/e/2PACX-1vRXfu7as7scLMqrv48bHpytzzRwK0VlgPfVrOJ_3MsqnNBzfC0TRjsfO52HSsVjMkAzWJaGvcMh12Hv/pub?output=csv";

let products=[],combinados=[],cart={},pending={};

const $=id=>document.getElementById(id);
const money=n=>"$"+n.toLocaleString("es-AR");

function parseCSV(t){
  const l=t.trim().split("\n");
  const h=l.shift().split(",");
  return l.map(r=>{
    const o={};
    r.split(",").forEach((v,i)=>o[h[i]]=v);
    return o;
  });
}

async function load(){
  const r=await fetch(SHEET+"&v="+Date.now());
  const d=parseCSV(await r.text()).filter(x=>x.activo=="1");
  products=d.filter(p=>!/^combinado/i.test(p.id));
  combinados=d.filter(p=>/^combinado/i.test(p.id));
  render();
}

function render(){
  $("products").innerHTML=products.map(p=>card(p)).join("");
  $("combinadosList").innerHTML=combinados.map(p=>card(p)).join("");
  renderCart();
}

function card(p){
  return `<div class="product">
    <img src="${p.imagen}" onerror="this.style.display='none'">
    <div>${p.nombre}</div>
    <div>${money(+p.precio)}</div>
    <div class="qty">
      <button onclick="chg('${p.id}',-1)">-</button>
      <span>${pending[p.id]||0}</span>
      <button onclick="chg('${p.id}',1)">+</button>
    </div>
    <button class="add" onclick="add('${p.id}')">AGREGAR</button>
  </div>`;
}

function chg(id,v){pending[id]=(pending[id]||0)+v;if(pending[id]<0)pending[id]=0;render()}
function add(id){cart[id]=(cart[id]||0)+(pending[id]||0);pending[id]=0;render()}

function renderCart(){
  const all=[...products,...combinados];
  let total=0,count=0;
  $("cartList").innerHTML=Object.keys(cart).map(id=>{
    const p=all.find(x=>x.id==id);
    const s=cart[id]*(+p.precio);
    total+=s;count+=cart[id];
    return `<li>${p.nombre} x${cart[id]} <b>${money(s)}</b></li>`;
  }).join("");
  $("cartTotal").textContent=money(total);
  $("cartCount").textContent=count;
}

document.querySelectorAll(".tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
    b.classList.add("active");
    $(b.dataset.tab).classList.add("active");
  }
});

$("cartTabBtn").onclick=()=>document.querySelector('[data-tab="carrito"]').click();
$("clearBtn").onclick=()=>{cart={};pending={};render()};

$("buyBtn").onclick=()=>{
  let msg="Hola quiero comprar:%0A";
  [...products,...combinados].forEach(p=>{
    if(cart[p.id])msg+=`${p.nombre} x${cart[p.id]}%0A`;
  });
  window.location=`https://wa.me/${WHATSAPP_PHONE}?text=${msg}`;
};

load();
</script>
</body>
</html>
